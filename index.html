<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Tournament Manager</title>
    <style>
        /* --- Global Styles & Variables --- */
        :root {
            --bg-color: #f4f7f6;
            --text-color: #333;
            --primary-color: #4CAF50;
            --primary-dark: #388E3C;
            --secondary-color: #2196F3;
            --accent-color: #FFC107;
            --border-color: #ddd;
            --card-bg: #fff;
            --input-bg: #f9f9f9;
            --shadow: 0 2px 5px rgba(0,0,0,0.1);
            --radius: 8px;
            --font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        body.dark-mode {
            --bg-color: #2c2c2c;
            --text-color: #e0e0e0;
            --primary-color: #66BB6A;
            --primary-dark: #43A047;
            --secondary-color: #64B5F6;
            --accent-color: #FFEB3B;
            --border-color: #555;
            --card-bg: #3a3a3a;
            --input-bg: #444;
            --shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- Layout --- */
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            flex-grow: 1;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 20px;
            text-align: center;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 {
            margin: 0;
            font-size: 1.8em;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px;
            border-radius: var(--radius);
            transition: background-color 0.2s;
        }
        .theme-toggle:hover {
            background-color: rgba(255,255,255,0.2);
        }

        nav {
            background-color: var(--card-bg);
            box-shadow: var(--shadow);
            border-radius: var(--radius);
            margin-top: 20px;
            display: flex;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        nav button {
            flex: 1;
            min-width: 120px;
            background: none;
            border: none;
            padding: 15px 20px;
            font-size: 1.1em;
            cursor: pointer;
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            border-bottom: 3px solid transparent;
        }

        nav button:hover {
            background-color: var(--bg-color);
        }

        nav button.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            font-weight: bold;
        }

        .content-section {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-top: 20px;
        }

        /* --- Typography --- */
        h2, h3, h4 {
            color: var(--primary-color);
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        h2 { font-size: 1.8em; }
        h3 { font-size: 1.4em; }
        h4 { font-size: 1.2em; }

        /* --- Forms --- */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-color);
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group input[type="date"],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            background-color: var(--input-bg);
            color: var(--text-color);
            font-size: 1em;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(var(--primary-color-rgb, 76, 175, 80), 0.2);
            outline: none;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        /* --- Buttons --- */
        .btn {
            display: inline-block;
            padding: 10px 20px;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            text-align: center;
            text-decoration: none;
            transition: background-color 0.2s, transform 0.1s;
            border: none;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }
        .btn-secondary:hover {
            background-color: #1976D2; /* Darker secondary */
            transform: translateY(-1px);
        }

        .btn-danger {
            background-color: #f44336;
            color: white;
        }
        .btn-danger:hover {
            background-color: #d32f2f;
            transform: translateY(-1px);
        }

        .btn-outline {
            background-color: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }
        .btn-outline:hover {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-1px);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* --- Lists & Cards --- */
        .tournament-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .tournament-card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .tournament-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }

        .tournament-card h3 {
            margin-top: 0;
            margin-bottom: 10px;
            border-bottom: none;
            padding-bottom: 0;
            color: var(--primary-color);
        }

        .tournament-card p {
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .tournament-card .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8em;
            font-weight: bold;
            margin-top: 10px;
        }

        .status.upcoming { background-color: var(--secondary-color); color: white; }
        .status.active { background-color: var(--primary-color); color: white; }
        .status.completed { background-color: #9E9E9E; color: white; }

        .no-data {
            text-align: center;
            padding: 40px;
            font-style: italic;
            color: var(--text-color);
            opacity: 0.7;
        }

        /* --- Tournament Detail Specifics --- */
        .tournament-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .tournament-detail-header h2 {
            margin: 0;
            border-bottom: none;
            padding-bottom: 0;
        }

        .tournament-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .tournament-info-item {
            background-color: var(--input-bg);
            padding: 15px;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
        }
        .tournament-info-item strong {
            display: block;
            margin-bottom: 5px;
            color: var(--primary-color);
        }

        .participants-list, .matches-list {
            list-style: none;
            padding: 0;
        }

        .participant-item, .match-item {
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .participant-item .actions, .match-item .actions {
            display: flex;
            gap: 8px;
        }

        .participant-item .actions .btn, .match-item .actions .btn {
            padding: 8px 12px;
            font-size: 0.9em;
        }

        /* --- Bracket Display (Single Elimination) --- */
        .bracket-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            overflow-x: auto;
        }

        .bracket-round {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
        }

        .bracket-round h4 {
            margin-bottom: 20px;
            text-align: center;
            width: 100%;
        }

        .bracket-matches {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .bracket-match {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            background-color: var(--card-bg);
            min-width: 250px;
            box-shadow: var(--shadow);
        }

        .bracket-match.winner {
            border-color: var(--primary-color);
            box-shadow: 0 0 10px rgba(var(--primary-color-rgb, 76, 175, 80), 0.5);
        }

        .bracket-match .player {
            padding: 5px 10px;
            margin: 2px 0;
            width: 100%;
            text-align: center;
            border-radius: 5px;
            background-color: var(--input-bg);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bracket-match .player.winner-player {
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
        }

        .bracket-match .score-input {
            width: 50px;
            padding: 5px;
            margin-left: 5px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .bracket-match .match-actions {
            margin-top: 10px;
            display: flex;
            gap: 5px;
        }

        .bracket-match .match-actions .btn {
            padding: 5px 10px;
            font-size: 0.85em;
        }

        /* Lines for bracket */
        .bracket-round:not(:last-child) .bracket-match::after {
            content: '';
            position: absolute;
            right: -20px; /* Half gap between rounds */
            top: 50%;
            width: 20px;
            height: 2px;
            background-color: var(--border-color);
            transform: translateY(-50%);
        }

        .bracket-round:not(:last-child) {
            margin-right: 40px; /* Gap between rounds */
        }

        .bracket-round:not(:last-child) .bracket-matches > div:nth-child(odd)::before,
        .bracket-round:not(:last-child) .bracket-matches > div:nth-child(even)::before {
            content: '';
            position: absolute;
            right: -20px;
            width: 2px;
            background-color: var(--border-color);
        }

        .bracket-round:not(:last-child) .bracket-matches > div:nth-child(odd)::before {
            top: 50%;
            height: calc(50% + 10px + 10px); /* Half match height + half gap */
            transform: translateY(-100%);
        }

        .bracket-round:not(:last-child) .bracket-matches > div:nth-child(even)::before {
            bottom: 50%;
            height: calc(50% + 10px + 10px);
            transform: translateY(0%);
        }

        .bracket-round:not(:last-child) .bracket-matches > div:nth-child(odd)::after {
            top: calc(50% - 10px);
        }
        .bracket-round:not(:last-child) .bracket-matches > div:nth-child(even)::after {
            bottom: calc(50% - 10px);
        }

        /* Adjust for actual bracket structure */
        .bracket-round-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 40px; /* Space between rounds */
        }

        .bracket-round {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            padding: 10px 0;
        }

        .bracket-match-pair {
            display: flex;
            flex-direction: column;
            gap: 20px; /* Gap between matches in a pair */
            position: relative;
            margin-bottom: 20px; /* Gap between pairs */
        }

        .bracket-match-pair:last-child {
            margin-bottom: 0;
        }

        .bracket-match-pair::before {
            content: '';
            position: absolute;
            left: -20px; /* Line from previous round */
            top: 50%;
            width: 20px;
            height: 2px;
            background-color: var(--border-color);
            transform: translateY(-50%);
        }

        .bracket-match-pair::after {
            content: '';
            position: absolute;
            left: -20px;
            top: 0;
            width: 2px;
            height: 100%;
            background-color: var(--border-color);
        }

        .bracket-round:first-child .bracket-match-pair::before,
        .bracket-round:first-child .bracket-match-pair::after {
            display: none;
        }

        .bracket-round:not(:first-child) .bracket-match-pair {
            margin-left: 20px; /* Indent for connection */
        }

        .bracket-round:not(:first-child) .bracket-match-pair > .bracket-match {
            margin-left: 0;
        }

        /* Simplified bracket structure for single file */
        .bracket-round-simple {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-right: 40px; /* Space between rounds */
            position: relative;
        }
        .bracket-round-simple:last-child {
            margin-right: 0;
        }

        .bracket-match-simple {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 10px;
            min-width: 200px;
            box-shadow: var(--shadow);
            position: relative;
        }

        .bracket-match-simple .player-line {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px dashed var(--border-color);
        }
        .bracket-match-simple .player-line:last-of-type {
            border-bottom: none;
        }
        .bracket-match-simple .player-line.winner-player {
            background-color: var(--primary-color);
            color: white;
            border-radius: 5px;
            padding: 5px 10px;
            margin: 2px -5px;
        }

        .bracket-match-simple .score-input {
            width: 40px;
            padding: 3px;
            margin-left: 5px;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            background-color: var(--bg-color);
            color: var(--text-color);
            text-align: center;
        }

        .bracket-match-simple .match-actions {
            margin-top: 10px;
            text-align: right;
        }
        .bracket-match-simple .match-actions .btn {
            padding: 5px 10px;
            font-size: 0.8em;
        }

        .bracket-round-simple h4 {
            text-align: center;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .bracket-visualizer {
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: auto;
            padding: 20px 0;
        }

        /* --- Round Robin Table --- */
        .round-robin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .round-robin-table th, .round-robin-table td {
            border: 1px solid var(--border-color);
            padding: 10px;
            text-align: left;
        }
        .round-robin-table th {
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
        }
        .round-robin-table tr:nth-child(even) {
            background-color: var(--input-bg);
        }
        .round-robin-table tr:hover {
            background-color: var(--bg-color);
        }

        .round-robin-table .score-input {
            width: 60px;
            padding: 5px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: var(--bg-color);
            color: var(--text-color);
            text-align: center;
        }

        /* --- Standings Table --- */
        .standings-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .standings-table th, .standings-table td {
            border: 1px solid var(--border-color);
            padding: 10px;
            text-align: left;
        }
        .standings-table th {
            background-color: var(--secondary-color);
            color: white;
            font-weight: bold;
        }
        .standings-table tr:nth-child(even) {
            background-color: var(--input-bg);
        }
        .standings-table tr:hover {
            background-color: var(--bg-color);
        }
        .standings-table td.rank {
            font-weight: bold;
            text-align: center;
        }

        /* --- Modals --- */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            padding-top: 60px;
        }

        .modal-content {
            background-color: var(--card-bg);
            margin: 5% auto;
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            width: 90%;
            max-width: 700px;
            position: relative;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content h3 {
            margin-top: 0;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        .close-button {
            color: var(--text-color);
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }

        .close-button:hover,
        .close-button:focus {
            color: var(--primary-color);
            text-decoration: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Utility & Responsive --- */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .flex-between {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .flex-gap-10 {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: var(--radius);
            font-weight: bold;
        }
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .search-filter-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .search-filter-bar input, .search-filter-bar select {
            flex: 1;
            min-width: 150px;
        }

        footer {
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            background-color: var(--card-bg);
            color: var(--text-color);
            border-top: 1px solid var(--border-color);
            font-size: 0.9em;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                margin: 10px auto;
                padding: 0 10px;
            }
            header h1 {
                font-size: 1.5em;
            }
            nav button {
                padding: 12px 15px;
                font-size: 1em;
            }
            .content-section {
                padding: 20px;
            }
            .form-grid {
                grid-template-columns: 1fr;
            }
            .tournament-list {
                grid-template-columns: 1fr;
            }
            .tournament-detail-header {
                flex-direction: column;
                align-items: flex-start;
            }
            .tournament-detail-header .btn-group {
                width: 100%;
                justify-content: flex-start;
            }
            .bracket-visualizer {
                justify-content: flex-start;
            }
            .bracket-round-simple {
                margin-right: 20px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Ultimate Tournament Manager</h1>
        <button id="themeToggle" class="theme-toggle">💡</button>
    </header>

    <div class="container">
        <nav>
            <button id="navDashboard" class="active">Dashboard</button>
            <button id="navCreateTournament">Create Tournament</button>
            <button id="navImportExport">Import/Export</button>
        </nav>

        <main id="appContent">
            <!-- Dashboard Section -->
            <section id="dashboardSection" class="content-section">
                <h2>All Tournaments</h2>
                <div class="search-filter-bar">
                    <input type="text" id="tournamentSearch" placeholder="Search tournaments...">
                    <select id="tournamentFilterStatus">
                        <option value="">All Statuses</option>
                        <option value="Upcoming">Upcoming</option>
                        <option value="Active">Active</option>
                        <option value="Completed">Completed</option>
                    </select>
                    <select id="tournamentFilterSport">
                        <option value="">All Sports</option>
                        <option value="Football">Football</option>
                        <option value="Basketball">Basketball</option>
                        <option value="Tennis">Tennis</option>
                        <option value="Esports">Esports</option>
                        <option value="Chess">Chess</option>
                        <option value="Other">Other</option>
                    </select>
                    <select id="tournamentFilterType">
                        <option value="">All Types</option>
                        <option value="Single Elimination">Single Elimination</option>
                        <option value="Round Robin">Round Robin</option>
                    </select>
                </div>
                <div id="tournamentList" class="tournament-list">
                    <p class="no-data">No tournaments created yet. Go to "Create Tournament" to get started!</p>
                </div>
            </section>

            <!-- Create Tournament Section -->
            <section id="createTournamentSection" class="content-section hidden">
                <h2>Create New Tournament</h2>
                <form id="createTournamentForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="tournamentName">Tournament Name <span style="color:red">*</span></label>
                            <input type="text" id="tournamentName" required>
                        </div>
                        <div class="form-group">
                            <label for="tournamentSport">Sport <span style="color:red">*</span></label>
                            <select id="tournamentSport" required>
                                <option value="">Select Sport</option>
                                <option value="Football">Football</option>
                                <option value="Basketball">Basketball</option>
                                <option value="Tennis">Tennis</option>
                                <option value="Esports">Esports</option>
                                <option value="Chess">Chess</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="tournamentType">Tournament Type <span style="color:red">*</span></label>
                            <select id="tournamentType" required>
                                <option value="">Select Type</option>
                                <option value="Single Elimination">Single Elimination</option>
                                <option value="Round Robin">Round Robin</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="tournamentStartDate">Start Date</label>
                            <input type="date" id="tournamentStartDate">
                        </div>
                        <div class="form-group">
                            <label for="tournamentEndDate">End Date</label>
                            <input type="date" id="tournamentEndDate">
                        </div>
                        <div class="form-group">
                            <label for="tournamentMaxParticipants">Max Participants</label>
                            <input type="number" id="tournamentMaxParticipants" min="2" placeholder="Optional">
                        </div>
                        <div class="form-group">
                            <label for="tournamentEntryFee">Entry Fee ($)</label>
                            <input type="number" id="tournamentEntryFee" min="0" step="0.01" value="0">
                        </div>
                        <div class="form-group">
                            <label for="tournamentPrizePool">Prize Pool ($)</label>
                            <input type="number" id="tournamentPrizePool" min="0" step="0.01" value="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="tournamentDescription">Description</label>
                        <textarea id="tournamentDescription" rows="3"></textarea>
                    </div>

                    <div id="roundRobinSettings" class="hidden">
                        <h3>Round Robin Specific Settings</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="rrPointsWin">Points for Win</label>
                                <input type="number" id="rrPointsWin" value="3" min="0">
                            </div>
                            <div class="form-group">
                                <label for="rrPointsDraw">Points for Draw</label>
                                <input type="number" id="rrPointsDraw" value="1" min="0">
                            </div>
                            <div class="form-group">
                                <label for="rrPointsLoss">Points for Loss</label>
                                <input type="number" id="rrPointsLoss" value="0" min="0">
                            </div>
                            <div class="form-group">
                                <label for="rrTieBreaker">Tie-breaker Preference</label>
                                <select id="rrTieBreaker">
                                    <option value="Head-to-Head">Head-to-Head</option>
                                    <option value="Score Difference">Score Difference</option>
                                    <option value="Score For">Score For</option>
                                    <option value="Random">Random</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Create Tournament</button>
                        <button type="reset" class="btn btn-outline">Clear Form</button>
                    </div>
                </form>
            </section>

            <!-- Tournament Detail Section (Dynamically loaded) -->
            <section id="tournamentDetailSection" class="content-section hidden">
                <div class="tournament-detail-header">
                    <h2 id="detailTournamentName"></h2>
                    <div class="btn-group">
                        <button id="editTournamentBtn" class="btn btn-secondary">Edit Tournament</button>
                        <button id="deleteTournamentBtn" class="btn btn-danger">Delete Tournament</button>
                        <select id="changeTournamentStatus" class="btn btn-outline">
                            <option value="Upcoming">Set Upcoming</option>
                            <option value="Active">Set Active</option>
                            <option value="Completed">Set Completed</option>
                        </select>
                        <button id="backToDashboardBtn" class="btn btn-outline">Back to Dashboard</button>
                    </div>
                </div>

                <div class="tournament-info-grid" id="tournamentInfoDisplay">
                    <!-- Info items will be loaded here -->
                </div>

                <hr style="margin: 30px 0; border-color: var(--border-color);">

                <h3>Participants (<span id="participantCount">0</span>/<span id="maxParticipants">∞</span>)</h3>
                <div class="flex-between" style="margin-bottom: 15px;">
                    <button id="addParticipantBtn" class="btn btn-primary">Add Participant</button>
                    <button id="generateBracketBtn" class="btn btn-secondary hidden">Generate Bracket</button>
                    <button id="generateRoundRobinBtn" class="btn btn-secondary hidden">Generate Matches</button>
                </div>
                <div id="participantsList" class="participants-list">
                    <p class="no-data">No participants added yet.</p>
                </div>

                <hr style="margin: 30px 0; border-color: var(--border-color);">

                <div id="bracketSection" class="hidden">
                    <h3>Bracket</h3>
                    <div id="bracketVisualizer" class="bracket-visualizer">
                        <p class="no-data">Bracket not generated. Add participants and click "Generate Bracket".</p>
                    </div>
                </div>

                <div id="roundRobinMatchesSection" class="hidden">
                    <h3>Matches</h3>
                    <div id="roundRobinMatches">
                        <p class="no-data">Matches not generated. Add participants and click "Generate Matches".</p>
                    </div>
                    <h3 style="margin-top: 30px;">Standings</h3>
                    <div id="roundRobinStandings">
                        <p class="no-data">Standings will appear after matches are generated and scores recorded.</p>
                    </div>
                </div>
            </section>

            <!-- Import/Export Section -->
            <section id="importExportSection" class="content-section hidden">
                <h2>Import / Export Data</h2>
                <div class="form-group">
                    <label>Export All Tournament Data</label>
                    <button id="exportDataBtn" class="btn btn-primary">Download Data (JSON)</button>
                    <p style="font-size: 0.9em; margin-top: 5px; opacity: 0.8;">This will download all your tournament data as a JSON file.</p>
                </div>
                <hr style="margin: 30px 0; border-color: var(--border-color);">
                <div class="form-group">
                    <label for="importFileInput">Import Tournament Data</label>
                    <input type="file" id="importFileInput" accept=".json">
                    <button id="importDataBtn" class="btn btn-secondary" style="margin-top: 10px;">Upload & Import Data</button>
                    <p style="font-size: 0.9em; margin-top: 5px; opacity: 0.8;">Upload a JSON file to restore or add tournament data. Existing tournaments with the same ID will be overwritten.</p>
                </div>
            </section>
        </main>
    </div>

    <footer>
        <p>&copy; 2023 Ultimate Tournament Manager. All data saved locally in your browser.</p>
    </footer>

    <!-- Modals -->

    <!-- Add/Edit Participant Modal -->
    <div id="participantModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('participantModal')">&times;</span>
            <h3 id="participantModalTitle">Add Participant</h3>
            <form id="participantForm">
                <input type="hidden" id="participantId">
                <div class="form-group">
                    <label for="participantName">Name / Team Name <span style="color:red">*</span></label>
                    <input type="text" id="participantName" required>
                </div>
                <div class="form-group">
                    <label for="participantSeed">Seed (for Single Elimination)</label>
                    <input type="number" id="participantSeed" min="1" placeholder="Optional">
                </div>
                <div class="form-group">
                    <label for="participantContact">Contact Info</label>
                    <input type="text" id="participantContact" placeholder="Email, Phone, etc.">
                </div>
                <div class="form-group">
                    <label for="participantNotes">Notes</label>
                    <textarea id="participantNotes" rows="2"></textarea>
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">Save Participant</button>
                    <button type="button" class="btn btn-outline" onclick="closeModal('participantModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Tournament Modal -->
    <div id="editTournamentModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('editTournamentModal')">&times;</span>
            <h3>Edit Tournament</h3>
            <form id="editTournamentForm">
                <input type="hidden" id="editTournamentId">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="editTournamentName">Tournament Name <span style="color:red">*</span></label>
                        <input type="text" id="editTournamentName" required>
                    </div>
                    <div class="form-group">
                        <label for="editTournamentSport">Sport <span style="color:red">*</span></label>
                        <select id="editTournamentSport" required>
                            <option value="Football">Football</option>
                            <option value="Basketball">Basketball</option>
                            <option value="Tennis">Tennis</option>
                            <option value="Esports">Esports</option>
                            <option value="Chess">Chess</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editTournamentType">Tournament Type <span style="color:red">*</span></label>
                        <select id="editTournamentType" required disabled>
                            <option value="Single Elimination">Single Elimination</option>
                            <option value="Round Robin">Round Robin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editTournamentStartDate">Start Date</label>
                        <input type="date" id="editTournamentStartDate">
                    </div>
                    <div class="form-group">
                        <label for="editTournamentEndDate">End Date</label>
                        <input type="date" id="editTournamentEndDate">
                    </div>
                    <div class="form-group">
                        <label for="editTournamentMaxParticipants">Max Participants</label>
                        <input type="number" id="editTournamentMaxParticipants" min="2">
                    </div>
                    <div class="form-group">
                        <label for="editTournamentEntryFee">Entry Fee ($)</label>
                        <input type="number" id="editTournamentEntryFee" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="editTournamentPrizePool">Prize Pool ($)</label>
                        <input type="number" id="editTournamentPrizePool" min="0" step="0.01">
                    </div>
                </div>
                <div class="form-group">
                    <label for="editTournamentDescription">Description</label>
                    <textarea id="editTournamentDescription" rows="3"></textarea>
                </div>

                <div id="editRoundRobinSettings" class="hidden">
                    <h3>Round Robin Specific Settings</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="editRrPointsWin">Points for Win</label>
                            <input type="number" id="editRrPointsWin" min="0">
                        </div>
                        <div class="form-group">
                            <label for="editRrPointsDraw">Points for Draw</label>
                            <input type="number" id="editRrPointsDraw" min="0">
                        </div>
                        <div class="form-group">
                            <label for="editRrPointsLoss">Points for Loss</label>
                            <input type="number" id="editRrPointsLoss" min="0">
                        </div>
                        <div class="form-group">
                            <label for="editRrTieBreaker">Tie-breaker Preference</label>
                            <select id="editRrTieBreaker">
                                <option value="Head-to-Head">Head-to-Head</option>
                                <option value="Score Difference">Score Difference</option>
                                <option value="Score For">Score For</option>
                                <option value="Random">Random</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                    <button type="button" class="btn btn-outline" onclick="closeModal('editTournamentModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- Global State & Constants ---
        const LS_KEY = 'tournamentManagerData';
        const LS_THEME_KEY = 'tournamentManagerTheme';
        let tournaments = [];
        let currentTournamentId = null;

        const TOURNAMENT_TYPES = {
            SINGLE_ELIMINATION: 'Single Elimination',
            ROUND_ROBIN: 'Round Robin'
        };

        const TOURNAMENT_STATUS = {
            UPCOMING: 'Upcoming',
            ACTIVE: 'Active',
            COMPLETED: 'Completed'
        };

        // --- Utility Functions ---
        function generateUniqueId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
        }

        function saveData() {
            localStorage.setItem(LS_KEY, JSON.stringify(tournaments));
        }

        function loadData() {
            const data = localStorage.getItem(LS_KEY);
            tournaments = data ? JSON.parse(data) : [];
            renderTournamentList();
        }

        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');

            document.querySelectorAll('nav button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`nav${sectionId.replace('Section', '')}`).classList.add('active');
        }

        function showAlert(message, type = 'success') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            document.querySelector('.container').prepend(alertDiv);
            setTimeout(() => alertDiv.remove(), 5000);
        }

        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // --- Theme Toggle ---
        function applyTheme(theme) {
            document.body.classList.toggle('dark-mode', theme === 'dark');
            localStorage.setItem(LS_THEME_KEY, theme);
        }

        function toggleTheme() {
            const currentTheme = localStorage.getItem(LS_THEME_KEY) || 'light';
            applyTheme(currentTheme === 'light' ? 'dark' : 'light');
        }

        // --- Tournament Management ---
        function createTournament(event) {
            event.preventDefault();

            const name = document.getElementById('tournamentName').value;
            const sport = document.getElementById('tournamentSport').value;
            const type = document.getElementById('tournamentType').value;
            const startDate = document.getElementById('tournamentStartDate').value;
            const endDate = document.getElementById('tournamentEndDate').value;
            const maxParticipants = parseInt(document.getElementById('tournamentMaxParticipants').value) || null;
            const entryFee = parseFloat(document.getElementById('tournamentEntryFee').value) || 0;
            const prizePool = parseFloat(document.getElementById('tournamentPrizePool').value) || 0;
            const description = document.getElementById('tournamentDescription').value;

            if (!name || !sport || !type) {
                showAlert('Please fill in all required fields (Name, Sport, Type).', 'error');
                return;
            }

            const newTournament = {
                id: generateUniqueId(),
                name, sport, type, startDate, endDate, description,
                maxParticipants, entryFee, prizePool,
                status: TOURNAMENT_STATUS.UPCOMING,
                participants: [],
                rounds: [], // For single elimination
                matches: [], // For round robin
                settings: {}
            };

            if (type === TOURNAMENT_TYPES.ROUND_ROBIN) {
                newTournament.settings = {
                    pointsWin: parseInt(document.getElementById('rrPointsWin').value) || 3,
                    pointsDraw: parseInt(document.getElementById('rrPointsDraw').value) || 1,
                    pointsLoss: parseInt(document.getElementById('rrPointsLoss').value) || 0,
                    tieBreaker: document.getElementById('rrTieBreaker').value || 'Score Difference'
                };
            }

            tournaments.push(newTournament);
            saveData();
            showAlert('Tournament created successfully!');
            document.getElementById('createTournamentForm').reset();
            renderTournamentList();
            showSection('dashboardSection');
        }

        function renderTournamentList() {
            const listDiv = document.getElementById('tournamentList');
            listDiv.innerHTML = '';

            const searchTerm = document.getElementById('tournamentSearch').value.toLowerCase();
            const filterStatus = document.getElementById('tournamentFilterStatus').value;
            const filterSport = document.getElementById('tournamentFilterSport').value;
            const filterType = document.getElementById('tournamentFilterType').value;

            const filteredTournaments = tournaments.filter(t => {
                const matchesSearch = t.name.toLowerCase().includes(searchTerm);
                const matchesStatus = filterStatus ? t.status === filterStatus : true;
                const matchesSport = filterSport ? t.sport === filterSport : true;
                const matchesType = filterType ? t.type === filterType : true;
                return matchesSearch && matchesStatus && matchesSport && matchesType;
            });

            if (filteredTournaments.length === 0) {
                listDiv.innerHTML = '<p class="no-data">No tournaments found matching your criteria.</p>';
                return;
            }

            filteredTournaments.forEach(tournament => {
                const card = document.createElement('div');
                card.className = 'tournament-card';
                card.innerHTML = `
                    <h3>${tournament.name}</h3>
                    <p><strong>Sport:</strong> ${tournament.sport}</p>
                    <p><strong>Type:</strong> ${tournament.type}</p>
                    <p><strong>Participants:</strong> ${tournament.participants.length} ${tournament.maxParticipants ? `/ ${tournament.maxParticipants}` : ''}</p>
                    <span class="status ${tournament.status.toLowerCase().replace(' ', '-')}">${tournament.status}</span>
                `;
                card.onclick = () => viewTournamentDetails(tournament.id);
                listDiv.appendChild(card);
            });
        }

        function viewTournamentDetails(id) {
            currentTournamentId = id;
            const tournament = tournaments.find(t => t.id === id);
            if (!tournament) {
                showAlert('Tournament not found!', 'error');
                showSection('dashboardSection');
                return;
            }

            document.getElementById('detailTournamentName').textContent = tournament.name;

            const infoDisplay = document.getElementById('tournamentInfoDisplay');
            infoDisplay.innerHTML = `
                <div class="tournament-info-item"><strong>Sport:</strong> ${tournament.sport}</div>
                <div class="tournament-info-item"><strong>Type:</strong> ${tournament.type}</div>
                <div class="tournament-info-item"><strong>Status:</strong> <span class="status ${tournament.status.toLowerCase().replace(' ', '-')}">${tournament.status}</span></div>
                <div class="tournament-info-item"><strong>Start Date:</strong> ${tournament.startDate || 'N/A'}</div>
                <div class="tournament-info-item"><strong>End Date:</strong> ${tournament.endDate || 'N/A'}</div>
                <div class="tournament-info-item"><strong>Max Participants:</strong> ${tournament.maxParticipants || 'Unlimited'}</div>
                <div class="tournament-info-item"><strong>Entry Fee:</strong> $${tournament.entryFee.toFixed(2)}</div>
                <div class="tournament-info-item"><strong>Prize Pool:</strong> $${tournament.prizePool.toFixed(2)}</div>
                <div class="tournament-info-item" style="grid-column: 1 / -1;"><strong>Description:</strong> ${tournament.description || 'No description.'}</div>
            `;

            // Update status dropdown
            const statusSelect = document.getElementById('changeTournamentStatus');
            statusSelect.value = tournament.status;

            // Show/hide bracket/round robin sections
            document.getElementById('bracketSection').classList.add('hidden');
            document.getElementById('roundRobinMatchesSection').classList.add('hidden');
            document.getElementById('generateBracketBtn').classList.add('hidden');
            document.getElementById('generateRoundRobinBtn').classList.add('hidden');

            if (tournament.type === TOURNAMENT_TYPES.SINGLE_ELIMINATION) {
                document.getElementById('bracketSection').classList.remove('hidden');
                document.getElementById('generateBracketBtn').classList.remove('hidden');
                renderBracket(tournament);
            } else if (tournament.type === TOURNAMENT_TYPES.ROUND_ROBIN) {
                document.getElementById('roundRobinMatchesSection').classList.remove('hidden');
                document.getElementById('generateRoundRobinBtn').classList.remove('hidden');
                renderRoundRobinMatches(tournament);
                renderRoundRobinStandings(tournament);
            }

            renderParticipantsList(tournament);
            showSection('tournamentDetailSection');
        }

        function editTournamentDetails() {
            const tournament = tournaments.find(t => t.id === currentTournamentId);
            if (!tournament) return;

            document.getElementById('editTournamentId').value = tournament.id;
            document.getElementById('editTournamentName').value = tournament.name;
            document.getElementById('editTournamentSport').value = tournament.sport;
            document.getElementById('editTournamentType').value = tournament.type; // Disabled, type cannot change
            document.getElementById('editTournamentStartDate').value = tournament.startDate;
            document.getElementById('editTournamentEndDate').value = tournament.endDate;
            document.getElementById('editTournamentMaxParticipants').value = tournament.maxParticipants;
            document.getElementById('editTournamentEntryFee').value = tournament.entryFee;
            document.getElementById('editTournamentPrizePool').value = tournament.prizePool;
            document.getElementById('editTournamentDescription').value = tournament.description;

            if (tournament.type === TOURNAMENT_TYPES.ROUND_ROBIN) {
                document.getElementById('editRoundRobinSettings').classList.remove('hidden');
                document.getElementById('editRrPointsWin').value = tournament.settings.pointsWin;
                document.getElementById('editRrPointsDraw').value = tournament.settings.pointsDraw;
                document.getElementById('editRrPointsLoss').value = tournament.settings.pointsLoss;
                document.getElementById('editRrTieBreaker').value = tournament.settings.tieBreaker;
            } else {
                document.getElementById('editRoundRobinSettings').classList.add('hidden');
            }

            openModal('editTournamentModal');
        }

        function saveEditedTournament(event) {
            event.preventDefault();
            const id = document.getElementById('editTournamentId').value;
            const tournament = tournaments.find(t => t.id === id);
            if (!tournament) return;

            tournament.name = document.getElementById('editTournamentName').value;
            tournament.sport = document.getElementById('editTournamentSport').value;
            // tournament.type is disabled, cannot be changed
            tournament.startDate = document.getElementById('editTournamentStartDate').value;
            tournament.endDate = document.getElementById('editTournamentEndDate').value;
            tournament.maxParticipants = parseInt(document.getElementById('editTournamentMaxParticipants').value) || null;
            tournament.entryFee = parseFloat(document.getElementById('editTournamentEntryFee').value) || 0;
            tournament.prizePool = parseFloat(document.getElementById('editTournamentPrizePool').value) || 0;
            tournament.description = document.getElementById('editTournamentDescription').value;

            if (tournament.type === TOURNAMENT_TYPES.ROUND_ROBIN) {
                tournament.settings.pointsWin = parseInt(document.getElementById('editRrPointsWin').value) || 3;
                tournament.settings.pointsDraw = parseInt(document.getElementById('editRrPointsDraw').value) || 1;
                tournament.settings.pointsLoss = parseInt(document.getElementById('editRrPointsLoss').value) || 0;
                tournament.settings.tieBreaker = document.getElementById('editRrTieBreaker').value || 'Score Difference';
            }

            saveData();
            showAlert('Tournament updated successfully!');
            closeModal('editTournamentModal');
            viewTournamentDetails(id); // Re-render details
        }

        function deleteTournament() {
            if (!confirm('Are you sure you want to delete this tournament and all its data?')) {
                return;
            }
            tournaments = tournaments.filter(t => t.id !== currentTournamentId);
            saveData();
            showAlert('Tournament deleted successfully!', 'danger');
            showSection('dashboardSection');
        }

        function changeTournamentStatus(event) {
            const newStatus = event.target.value;
            const tournament = tournaments.find(t => t.id === currentTournamentId);
            if (tournament) {
                tournament.status = newStatus;
                saveData();
                showAlert(`Tournament status changed to ${newStatus}.`);
                viewTournamentDetails(currentTournamentId); // Re-render details
            }
        }

        // --- Participant Management ---
        function renderParticipantsList(tournament) {
            const listDiv = document.getElementById('participantsList');
            listDiv.innerHTML = '';
            document.getElementById('participantCount').textContent = tournament.participants.length;
            document.getElementById('maxParticipants').textContent = tournament.maxParticipants || '∞';

            if (tournament.participants.length === 0) {
                listDiv.innerHTML = '<p class="no-data">No participants added yet.</p>';
                return;
            }

            tournament.participants.sort((a, b) => (a.seed || Infinity) - (b.seed || Infinity)); // Sort by seed

            tournament.participants.forEach(p => {
                const item = document.createElement('div');
                item.className = 'participant-item';
                item.innerHTML = `
                    <div>
                        <strong>${p.name}</strong>
                        ${p.seed ? ` (Seed: ${p.seed})` : ''}
                        ${p.contact ? `<br><small>${p.contact}</small>` : ''}
                    </div>
                    <div class="actions">
                        <button class="btn btn-secondary" onclick="editParticipant('${p.id}')">Edit</button>
                        <button class="btn btn-danger" onclick="deleteParticipant('${p.id}')">Delete</button>
                    </div>
                `;
                listDiv.appendChild(item);
            });
        }

        function openAddParticipantModal() {
            document.getElementById('participantModalTitle').textContent = 'Add Participant';
            document.getElementById('participantForm').reset();
            document.getElementById('participantId').value = '';
            openModal('participantModal');
        }

        function addOrUpdateParticipant(event) {
            event.preventDefault();
            const tournament = tournaments.find(t => t.id === currentTournamentId);
            if (!tournament) return;

            const participantId = document.getElementById('participantId').value;
            const name = document.getElementById('participantName').value;
            const seed = parseInt(document.getElementById('participantSeed').value) || null;
            const contact = document.getElementById('participantContact').value;
            const notes = document.getElementById('participantNotes').value;

            if (!name) {
                showAlert('Participant name is required.', 'error');
                return;
            }

            if (tournament.maxParticipants && tournament.participants.length >= tournament.maxParticipants && !participantId) {
                showAlert(`Cannot add more participants. Max is ${tournament.maxParticipants}.`, 'error');
                return;
            }

            if (participantId) {
                // Update existing participant
                const participant = tournament.participants.find(p => p.id === participantId);
                if (participant) {
                    participant.name = name;
                    participant.seed = seed;
                    participant.contact = contact;
                    participant.notes = notes;
                    showAlert('Participant updated successfully!');
                }
            } else {
                // Add new participant
                const newParticipant = {
                    id: generateUniqueId(),
                    name, seed, contact, notes,
                    wins: 0, losses: 0, draws: 0, scoreFor: 0, scoreAgainst: 0, points: 0 // For Round Robin
                };
                tournament.participants.push(newParticipant);
                showAlert('Participant added successfully!');
            }

            saveData();
            renderParticipantsList(tournament);
            closeModal('participantModal');
        }

        function editParticipant(participantId) {
            const tournament = tournaments.find(t => t.id === currentTournamentId);
            const participant = tournament.participants.find(p => p.id === participantId);
            if (!participant) return;

            document.getElementById('participantModalTitle').textContent = 'Edit Participant';
            document.getElementById('participantId').value = participant.id;
            document.getElementById('participantName').value = participant.name;
            document.getElementById('participantSeed').value = participant.seed;
            document.getElementById('participantContact').value = participant.contact;
            document.getElementById('participantNotes').value = participant.notes;
            openModal('participantModal');
        }

        function deleteParticipant(participantId) {
            if (!confirm('Are you sure you want to delete this participant?')) {
                return;
            }
            const tournament = tournaments.find(t => t.id === currentTournamentId);
            if (tournament) {
                tournament.participants = tournament.participants.filter(p => p.id !== participantId);
                // Reset bracket/matches if participants change
                tournament.rounds = [];
                tournament.matches = [];
                saveData();
                showAlert('Participant deleted successfully!', 'danger');
                viewTournamentDetails(currentTournamentId); // Re-render details
            }
        }

        // --- Single Elimination Bracket Logic ---
        function generateSingleEliminationBracket() {
            const tournament = tournaments.find(t => t.id === currentTournamentId);
            if (!tournament) return;

            if (tournament.participants.length < 2) {
                showAlert('Need at least 2 participants to generate a bracket.', 'error');
                return;
            }

            if (tournament.rounds.length > 0 && !confirm('Bracket already generated. Regenerating will clear all scores. Continue?')) {
                return;
            }

            // Sort participants by seed, then randomly
            let sortedParticipants = [...tournament.participants].sort((a, b) => {
                if (a.seed && b.seed) return a.seed - b.seed;
                if (a.seed) return -1; // Seeded players first
                if (b.seed) return 1;
                return Math.random() - 0.5; // Random for unseeded
            });

            const numParticipants = sortedParticipants.length;
            let numRounds = Math.ceil(Math.log2(numParticipants));
            let totalSlots = Math.pow(2, numRounds);
            let byes = totalSlots - numParticipants;

            tournament.rounds = [];

            // Round 1: Handle byes and initial pairings
            let round1Matches = [];
            let participantsForRound = [];

            // Assign byes to highest seeds first
            for (let i = 0; i < byes; i++) {
                participantsForRound.push({ participant: sortedParticipants[i], bye: true });
            }
            // Add remaining participants
            for (let i = byes; i < numParticipants; i++) {
                participantsForRound.push({ participant: sortedParticipants[i], bye: false });
            }

            // Shuffle participants for pairing, keeping byes at the top
            const seededParticipants = participantsForRound.filter(p => p.participant.seed);
            const unseededParticipants = participantsForRound.filter(p => !p.participant.seed);

            // Simple pairing for now: seeded vs unseeded, then random
            let currentParticipants = [];
            if (seededParticipants.length > 0) {
                currentParticipants = seededParticipants.concat(unseededParticipants.sort(() => Math.random() - 0.5));
            } else {
                currentParticipants = participantsForRound.sort(() => Math.random() - 0.5);
            }

            // Ensure byes are handled correctly in pairing
            let actualParticipants = currentParticipants.filter(p => !p.bye).map(p => p.participant);
            let byeParticipants = currentParticipants.filter(p => p.bye).map(p => p.participant);

            let roundParticipants = [];
            // Pair byes with lowest seeds if possible, or just advance them
            if (byes > 0) {
                // For simplicity, byes just advance. A more complex system would pair byes with lowest seeds.
                // Here, we just ensure the correct number of participants advance to the next round.
                roundParticipants = [...byeParticipants, ...actualParticipants];
            } else {
                roundParticipants = actualParticipants;
            }

            // Create initial matches
            let currentMatchups = [];
            for (let i = 0; i < roundParticipants.length; i += 2) {
                const p1 = roundParticipants[i];
                const p2 = roundParticipants[i + 1];

                if (p1 && p2) {
                    currentMatchups.push({
                        id: generateUniqueId(),
                        player1Id: p1.id,
                        player2Id: p2.id,
                        score1: null,
                        score2: null,
                        winnerId: null,
                        status: 'Upcoming'
                    });
                } else if (p1) { // Odd number of participants, last one gets a bye
                    currentMatchups.push({
                        id: generateUniqueId(),
                        player1Id: p1.id,
                        player2Id: null, // Represents a bye
                        score1: null,
                        score2: null,
                        winnerId: p1.id, // Player with bye automatically wins
                        status: 'Completed - Bye'
                    });
                }
            }
            tournament.rounds.push({ name: 'Round 1', matches: currentMatchups });

            // Subsequent rounds
            for (let r = 1; r < numRounds; r++) {
                let nextRoundMatches = [];
                let prevRoundMatches = tournament.rounds[r - 1].matches;
                let winners = prevRoundMatches.filter(m => m.winnerId).map(m => m.winnerId);

                // If there's an odd number of winners, one gets a bye in the next round
                if (winners.length % 2 !== 0 && winners.length > 1) {
                    // For simplicity, the last winner gets a bye. More complex logic could be applied.
                    const byeWinnerId = winners.pop();
                    nextRoundMatches.push({
                        id: generateUniqueId(),
                        player1Id: byeWinnerId,
                        player2Id: null,
                        score1: null,
                        score2: null,
                        winnerId: byeWinnerId,
                        status: 'Completed - Bye'
                    });
                }

                for (let i = 0; i < winners.length; i += 2) {
                    const p1Id = winners[i];
                    const p2Id = winners[i + 1];
                    if (p1Id && p2Id) {
                        nextRoundMatches.push({
                            id: generateUniqueId(),
                            player1Id: p1Id,
                            player2Id: p2Id,
                            score1: null,
                            score2: null,
                            winnerId: null,
                            status: 'Upcoming'
                        });
                    }
                }
                if (nextRoundMatches.length > 0) {
                    tournament.rounds.push({ name: `Round ${r + 1}`, matches: nextRoundMatches });
                }
            }

            saveData();
            showAlert('Bracket generated successfully!');
            renderBracket(tournament);
        }

        function renderBracket(tournament) {
            const bracketVisualizer = document.getElementById('bracketVisualizer');
            bracketVisualizer.innerHTML = '';

            if (tournament.rounds.length === 0) {
                bracketVisualizer.innerHTML = '<p class="no-data">Bracket not generated. Add participants and click "Generate Bracket".</p>';
                return;
            }

            const bracketWrapper = document.createElement('div');
            bracketWrapper.className = 'bracket-round-wrapper';

            tournament.rounds.forEach((round, roundIndex) => {
                const roundDiv = document.createElement('div');
                roundDiv.className = 'bracket-round-simple';
                roundDiv.innerHTML = `<h4>${round.name}</h4>`;

                round.matches.forEach(match => {
                    const p1 = tournament.participants.find(p => p.id === match.player1Id);
                    const p2 = tournament.participants.find(p => p.id === match.player2Id);

                    const matchDiv = document.createElement('div');
                    matchDiv.className = `bracket-match-simple ${match.winnerId ? 'winner' : ''}`;
                    matchDiv.innerHTML = `
                        <div class="player-line ${match.winnerId === p1?.id ? 'winner-player' : ''}">
                            <span>${p1 ? p1.name : 'BYE'}</span>
                            ${p1 ? `<input type="number" class="score-input" value="${match.score1 !== null ? match.score1 : ''}" data-player="1" ${match.status !== 'Upcoming' ? 'disabled' : ''}>` : ''}
                        </div>
                        <div class="player-line ${match.winnerId === p2?.id ? 'winner-player' : ''}">
                            <span>${p2 ? p2.name : 'BYE'}</span>
                            ${p2 ? `<input type="number" class="score-input" value="${match.score2 !== null ? match.score2 : ''}" data-player="2" ${match.status !== 'Upcoming' ? 'disabled' : ''}>` : ''}
                        </div>
                        <div class="match-actions">
                            ${match.status === 'Upcoming' ? `<button class="btn btn-primary" onclick="recordSingleEliminationScore('${match.id}', ${roundIndex})">Record Score</button>` : ''}
                            ${match.status === 'Completed' ? `<span style="color: var(--primary-color); font-weight: bold;">Winner: ${tournament.participants.find(p => p.id === match.winnerId)?.name || 'N/A'}</span>` : ''}
                            ${match.status === 'Completed - Bye' ? `<span style="color: var(--secondary-color); font-weight: bold;">BYE - ${p1?.name || 'N/A'} Advances</span>` : ''}
                        </div>
                    `;
                    roundDiv.appendChild(matchDiv);
                });
                bracketWrapper.appendChild(roundDiv);
            });
            bracketVisualizer.appendChild(bracketWrapper);

            // Check for overall winner
            const lastRound = tournament.rounds[tournament.rounds.length - 1];
            if (lastRound && lastRound.matches.length === 1 && lastRound.matches[0].winnerId) {
                const winner = tournament.participants.find(p => p.id === lastRound.matches[0].winnerId);
                bracketVisualizer.insertAdjacentHTML('beforeend', `<h3 class="text-center" style="margin-top: 30px; color: var(--accent-color);">🏆 Tournament Winner: ${winner.name} 🏆</h3>`);
            }
        }

        function recordSingleEliminationScore(matchId, roundIndex) {
            const tournament = tournaments.find(t => t.id === currentTournamentId);
            if (!tournament) return;

            const round = tournament.rounds[roundIndex];
            const match = round.matches.find(m => m.id === matchId);
            if (!match) return;

            const matchElement = document.querySelector(`#bracketVisualizer .bracket-match-simple .match-actions button[onclick*="${matchId}"]`).closest('.bracket-match-simple');
            const score1Input = matchElement.querySelector('input[data-player="1"]');
            const score2Input = matchElement.querySelector('input[data-player="2"]');

            const score1 = parseInt(score1Input.value);
            const score2 = parseInt(score2Input.value);

            if (isNaN(score1) || isNaN(score2)) {
                showAlert('Please enter valid scores for both players.', 'error');
                return;
            }

            match.score1 = score1;
            match.score2 = score2;

            if (score1 > score2) {
                match.winnerId = match.player1Id;
            } else if (score2 > score1) {
                match.winnerId = match.player2Id;
            } else {
                showAlert('Scores cannot be tied in single elimination. Please enter a clear winner.', 'error');
                return;
            }
            match.status = 'Completed';

            // Advance winner to next round if it exists
            if (roundIndex < tournament.rounds.length - 1) {
                const nextRound = tournament.rounds[roundIndex + 1];
                let foundNextMatch = false;
                for (const nextMatch of nextRound.matches) {
                    if (nextMatch.player1Id === null && nextMatch.player2Id === null) { // Empty slot
                        nextMatch.player1Id = match.winnerId;
                        foundNextMatch = true;
                        break;
                    } else if (nextMatch.player1Id === null && nextMatch.player2Id !== null) { // Slot for P1
                        nextMatch.player1Id = match.winnerId;
                        foundNextMatch = true;
                        break;
                    } else if (nextMatch.player2Id === null && nextMatch.player1Id !== null) { // Slot for P2
                        nextMatch.player2Id = match.winnerId;
                        foundNextMatch = true;
                        break;
                    }
                }
                // If no empty slot found, it means the bracket logic needs to be more robust
                // For now, we assume slots are available or created.
                // A more advanced system would pre-create empty matches for future rounds.
            }

            saveData();
            showAlert(`Score recorded for match. ${tournament.participants.find(p => p.id === match.winnerId)?.name} advances!`);
            renderBracket(tournament); // Re-render to update bracket
        }


        // --- Round Robin Logic ---
        function generateRoundRobinMatches() {
            const tournament = tournaments.find(t => t.id === currentTournamentId);
            if (!tournament) return;

            if (tournament.participants.length < 2) {
                showAlert('Need at least 2 participants to generate matches.', 'error');
                return;
            }

            if (tournament.matches.length > 0 && !confirm('Matches already generated. Regenerating will clear all scores. Continue?')) {
                return;
            }

            tournament.matches = [];
            const participants = tournament.participants;
            const numParticipants = participants.length;

            for (let i = 0; i < numParticipants; i++) {
                for (let j = i + 1; j < numParticipants; j++) {
                    tournament.matches.push({
                        id: generateUniqueId(),
                        player1Id: participants[i].id,
                        player2Id: participants[j].id,
                        score1: null,
                        score2: null,
                        winnerId: null,
                        status: 'Upcoming'
                    });
                }
            }
            saveData();
            showAlert('Round Robin matches generated successfully!');
            renderRoundRobinMatches(tournament);
            renderRoundRobinStandings(tournament);
        }

        function renderRoundRobinMatches(tournament) {
            const matchesDiv = document.getElementById('roundRobinMatches');
            matchesDiv.innerHTML = '';

            if (tournament.matches.length === 0) {
                matchesDiv.innerHTML = '<p class="no-data">Matches not generated. Add participants and click "Generate Matches".</p>';
                return;
            }

            const table = document.createElement('table');
            table.className = 'round-robin-table';
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Match</th>
                        <th>Player 1</th>
                        <th>Score</th>
                        <th>Player 2</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            `;
            const tbody = table.querySelector('tbody');

            tournament.matches.forEach(match => {
                const p1 = tournament.participants.find(p => p.id === match.player1Id);
                const p2 = tournament.participants.find(p => p.id === match.player2Id);

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${p1?.name || 'N/A'} vs ${p2?.name || 'N/A'}</td>
                    <td>${p1?.name || 'N/A'}</td>
                    <td>
                        <input type="number" class="score-input" value="${match.score1 !== null ? match.score1 : ''}" data-match-id="${match.id}" data-player="1" ${match.status !== 'Upcoming' ? 'disabled' : ''}>
                        -
                        <input type="number" class="score-input" value="${match.score2 !== null ? match.score2 : ''}" data-match-id="${match.id}" data-player="2" ${match.status !== 'Upcoming' ? 'disabled' : ''}>
                    </td>
                    <td>${p2?.name || 'N/A'}</td>
                    <td>${match.status}</td>
                    <td>
                        ${match.status === 'Upcoming' ? `<button class="btn btn-primary btn-sm" onclick="recordRoundRobinScore('${match.id}')">Record</button>` : ''}
                        ${match.status === 'Completed' ? `<span style="color: var(--primary-color); font-weight: bold;">Winner: ${tournament.participants.find(p => p.id === match.winnerId)?.name || 'Draw'}</span>` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
            matchesDiv.appendChild(table);
        }

        function recordRoundRobinScore(matchId) {
            const tournament = tournaments.find(t => t.id === currentTournamentId);
            if (!tournament) return;

            const match = tournament.matches.find(m => m.id === matchId);
            if (!match) return;

            const score1Input = document.querySelector(`input[data-match-id="${matchId}"][data-player="1"]`);
            const score2Input = document.querySelector(`input[data-match-id="${matchId}"][data-player="2"]`);

            const score1 = parseInt(score1Input.value);
            const score2 = parseInt(score2Input.value);

            if (isNaN(score1) || isNaN(score2)) {
                showAlert('Please enter valid scores for both players.', 'error');
                return;
            }

            match.score1 = score1;
            match.score2 = score2;

            if (score1 > score2) {
                match.winnerId = match.player1Id;
            } else if (score2 > score1) {
                match.winnerId = match.player2Id;
            } else {
                match.winnerId = null; // Draw
            }
            match.status = 'Completed';

            saveData();
            showAlert('Score recorded successfully!');
            renderRoundRobinMatches(tournament);
            renderRoundRobinStandings(tournament);
        }

        function renderRoundRobinStandings(tournament) {
            const standingsDiv = document.getElementById('roundRobinStandings');
            standingsDiv.innerHTML = '';

            if (tournament.matches.length === 0) {
                standingsDiv.innerHTML = '<p class="no-data">Standings will appear after matches are generated and scores recorded.</p>';
                return;
            }

            const participantStats = {};
            tournament.participants.forEach(p => {
                participantStats[p.id] = {
                    id: p.id,
                    name: p.name,
                    wins: 0, losses: 0, draws: 0,
                    scoreFor: 0, scoreAgainst: 0,
                    points: 0
                };
            });

            tournament.matches.forEach(match => {
                if (match.status === 'Completed') {
                    const p1Stats = participantStats[match.player1Id];
                    const p2Stats = participantStats[match.player2Id];

                    if (!p1Stats || !p2Stats) return; // Should not happen

                    p1Stats.scoreFor += match.score1;
                    p1Stats.scoreAgainst += match.score2;
                    p2Stats.scoreFor += match.score2;
                    p2Stats.scoreAgainst += match.score1;

                    if (match.winnerId === match.player1Id) {
                        p1Stats.wins++;
                        p2Stats.losses++;
                        p1Stats.points += tournament.settings.pointsWin;
                        p2Stats.points += tournament.settings.pointsLoss;
                    } else if (match.winnerId === match.player2Id) {
                        p2Stats.wins++;
                        p1Stats.losses++;
                        p2Stats.points += tournament.settings.pointsWin;
                        p1Stats.points += tournament.settings.pointsLoss;
                    } else { // Draw
                        p1Stats.draws++;
                        p2Stats.draws++;
                        p1Stats.points += tournament.settings.pointsDraw;
                        p2Stats.points += tournament.settings.pointsDraw;
                    }
                }
            });

            let standings = Object.values(participantStats);

            // Sort standings
            standings.sort((a, b) => {
                if (b.points !== a.points) return b.points - a.points;
                // Tie-breaking rules
                switch (tournament.settings.tieBreaker) {
                    case 'Score Difference':
                        return (b.scoreFor - b.scoreAgainst) - (a.scoreFor - a.scoreAgainst);
                    case 'Score For':
                        return b.scoreFor - a.scoreFor;
                    case 'Head-to-Head':
                        // This is complex for multi-way ties, simplified for single file
                        // For a true head-to-head, you'd need to filter matches between tied players
                        // and calculate a mini-standings. For simplicity, we'll just use score diff if H2H is chosen.
                        return (b.scoreFor - b.scoreAgainst) - (a.scoreFor - a.scoreAgainst);
                    case 'Random':
                    default:
                        return Math.random() - 0.5;
                }
            });

            const table = document.createElement('table');
            table.className = 'standings-table';
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Participant</th>
                        <th>W</th>
                        <th>L</th>
                        <th>D</th>
                        <th>GF</th>
                        <th>GA</th>
                        <th>GD</th>
                        <th>Pts</th>
                    </tr>
                </thead>
                <tbody></tbody>
            `;
            const tbody = table.querySelector('tbody');

            standings.forEach((stats, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="rank">${index + 1}</td>
                    <td>${stats.name}</td>
                    <td>${stats.wins}</td>
                    <td>${stats.losses}</td>
                    <td>${stats.draws}</td>
                    <td>${stats.scoreFor}</td>
                    <td>${stats.scoreAgainst}</td>
                    <td>${stats.scoreFor - stats.scoreAgainst}</td>
                    <td>${stats.points}</td>
                `;
                tbody.appendChild(row);
            });
            standingsDiv.appendChild(table);
        }

        // --- Import/Export ---
        function exportData() {
            const dataStr = JSON.stringify(tournaments, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `tournament_manager_data_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showAlert('Data exported successfully!');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) {
                showAlert('No file selected.', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (!Array.isArray(importedData)) {
                        throw new Error('Invalid JSON format. Expected an array of tournaments.');
                    }

                    // Merge or overwrite logic
                    if (confirm('Do you want to REPLACE all existing data with the imported data? Click Cancel to MERGE (add new, update existing by ID).')) {
                        tournaments = importedData;
                        showAlert('All data replaced successfully!', 'success');
                    } else {
                        importedData.forEach(importedTournament => {
                            const existingIndex = tournaments.findIndex(t => t.id === importedTournament.id);
                            if (existingIndex !== -1) {
                                tournaments[existingIndex] = importedTournament; // Update existing
                            } else {
                                tournaments.push(importedTournament); // Add new
                            }
                        });
                        showAlert('Data merged successfully!', 'success');
                    }

                    saveData();
                    renderTournamentList();
                    showSection('dashboardSection');
                    document.getElementById('importFileInput').value = ''; // Clear file input
                } catch (error) {
                    showAlert(`Error importing data: ${error.message}`, 'error');
                }
            };
            reader.readAsText(file);
        }

        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            // Load theme
            const savedTheme = localStorage.getItem(LS_THEME_KEY) || 'light';
            applyTheme(savedTheme);

            loadData();
            renderTournamentList(); // Initial render

            // Navigation
            document.getElementById('navDashboard').addEventListener('click', () => showSection('dashboardSection'));
            document.getElementById('navCreateTournament').addEventListener('click', () => {
                showSection('createTournamentSection');
                document.getElementById('createTournamentForm').reset();
                document.getElementById('roundRobinSettings').classList.add('hidden');
            });
            document.getElementById('navImportExport').addEventListener('click', () => showSection('importExportSection'));

            // Theme Toggle
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);

            // Create Tournament Form
            document.getElementById('createTournamentForm').addEventListener('submit', createTournament);
            document.getElementById('tournamentType').addEventListener('change', (e) => {
                if (e.target.value === TOURNAMENT_TYPES.ROUND_ROBIN) {
                    document.getElementById('roundRobinSettings').classList.remove('hidden');
                } else {
                    document.getElementById('roundRobinSettings').classList.add('hidden');
                }
            });

            // Tournament Detail Actions
            document.getElementById('backToDashboardBtn').addEventListener('click', () => showSection('dashboardSection'));
            document.getElementById('editTournamentBtn').addEventListener('click', editTournamentDetails);
            document.getElementById('deleteTournamentBtn').addEventListener('click', deleteTournament);
            document.getElementById('changeTournamentStatus').addEventListener('change', changeTournamentStatus);

            // Edit Tournament Modal Form
            document.getElementById('editTournamentForm').addEventListener('submit', saveEditedTournament);
            document.getElementById('editTournamentType').addEventListener('change', (e) => {
                if (e.target.value === TOURNAMENT_TYPES.ROUND_ROBIN) {
                    document.getElementById('editRoundRobinSettings').classList.remove('hidden');
                } else {
                    document.getElementById('editRoundRobinSettings').classList.add('hidden');
                }
            });


            // Participant Management
            document.getElementById('addParticipantBtn').addEventListener('click', openAddParticipantModal);
            document.getElementById('participantForm').addEventListener('submit', addOrUpdateParticipant);

            // Bracket/Match Generation
            document.getElementById('generateBracketBtn').addEventListener('click', generateSingleEliminationBracket);
            document.getElementById('generateRoundRobinBtn').addEventListener('click', generateRoundRobinMatches);

            // Search and Filter
            document.getElementById('tournamentSearch').addEventListener('input', renderTournamentList);
            document.getElementById('tournamentFilterStatus').addEventListener('change', renderTournamentList);
            document.getElementById('tournamentFilterSport').addEventListener('change', renderTournamentList);
            document.getElementById('tournamentFilterType').addEventListener('change', renderTournamentList);

            // Import/Export
            document.getElementById('exportDataBtn').addEventListener('click', exportData);
            document.getElementById('importFileInput').addEventListener('change', importData);
        });
    </script>
</body>
</html>
